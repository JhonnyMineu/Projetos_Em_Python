import requests
import pandas as pd
from bs4 import BeautifulSoup

# Obtendo valores de url e trazendo o código HTML da página
url = 'https://www.nfl.com/stats/player-stats/'
soup = requests.get(url)
site = BeautifulSoup(soup.text, 'html.parser')

# Criando loop para colocar as informações do cabeçalho da tabela dentro de uma lista
lista = []
nomes_co = []

contagem_colunas = site.find_all('th',{'class':'header'})
colunas = site.find('tr')

for i in contagem_colunas:
  lista.append(i.get_text().strip())
  nomes_co.append(i.get_text().strip())

# Obtendo o nome da página para criar um DataFrame de forma automática
pagina = site.find('li',{'class':'d3-o-tabs__list-item d3-is-active'})
DF_pagina = pagina.get_text()

df = pd.DataFrame(columns=nomes_co)
# Listando as colunas do DataFrame
data = list(df.columns)

table = site.find('table')

#Transformando cada linha de dado da tabela em uma linha do DataFrame de forma dinâmica
for row in table.tbody.find_all('tr'):
  columns = row.find_all('td')

  # Obtendo colunas de cada linha
  if (columns !=[]):
    valores_coletados = {}
    
    # Fazendo loop dinâmico para armazenar em 'valores_coletados' cada nome da coluna e valor referente extraidos da tabela do site
    for i in range(0,(len(nomes_co))):
      campo = columns[i].text.strip()
      valores_coletados[data[i]] = campo

      # Condicional para só inputar no DataFrame quando a quantidade de colunas existentes estiver igual a de colunas coletadas
      if i == (len(nomes_co)-1):
        df= pd.concat([df,pd.DataFrame.from_records([valores_coletados])], ignore_index=True) # Input no DataFrame

# Exportando o DataFrame em formato CSV
df.to_excel('NFL_Tabela.xlsx')
